<!DOCTYPE html>
<html lang="tr">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>EZ-Check Denetim Sistemi</title>


  <!-- Bootstrap CSS CDN -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">

  <!-- Our Custom CSS -->
  {% load static %}
  <link rel="stylesheet" href="{% static 'sidebar/style2.css' %}">

  <!-- Scrollbar Custom CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/malihu-custom-scrollbar-plugin/3.1.5/jquery.mCustomScrollbar.min.css">

  <!--  dropdown için... -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">


  <!-- <link rel="stylesheet" href="{% static 'css/w3.css' %}">  -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"  />


  <!-- dropdown  -->
  <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
  <!-- jQuery CDN -->
  <!-- Bootstrap Js CDN -->
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <!-- jQuery Custom Scroller CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/malihu-custom-scrollbar-plugin/3.1.5/jquery.mCustomScrollbar.concat.min.js"></script>




<style>

body {
background-color: #ececec;
}

.navbar {
    /* overflow: hidden;  */
    background-color: #8b898e;
    font-family: Arial, Helvetica, sans-serif;
}

.navbar a {
    float: right;
    font-size: 16px;
    color: white;
    text-align: center;
    padding: 5px 15px;
    text-decoration: none;
}

.btn-info {
    background-color: #f5ca0a;
}


.dropdown {
    float: left;
    /* overflow: hidden; */
    height: 150px;

}

.dropdown .dropbtn2 {
    cursor: pointer;
    font-size: 16px;
    border: none;
    outline: none;
    color: white;
    padding: 14px 16px;
    background-color: inherit;
    font-family: inherit;
    margin: 0;
}

/*
.navbar a:hover, .dropdown:hover .dropbtn2, .dropbtn2:focus {
    background-color: red;
}
*/

.dropdown-content2 {
    /* display: none; */
    background-color: #f9f9f9;
    min-width: 160px;
    z-index: 1;
    /* min-height:90px; */
    /* overflow-y :auto; */
    overflow-x:hidden;
    position:absolute;
    /* width:300px; */
    /* display: contents; */
    display: none;
    box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
    width: 300px;
    height: 150px;
    overflow-y: scroll;
    /* background-color: #82caff; */

}

.dropdown-content2 a {
    float: none;
    color: black;
    padding: 12px 16px;
    text-decoration: none;
    display: block;
    text-align: left;
}

.dropdown-content2 a:hover {
    background-color: #f2f2f2;
}

.show {
    display: block;
}

.c {
    text-align: center;
    vertical-align: middle;
}


a.fa-bell {
  position: relative;
  font-size: 2em;
  color: grey;
  cursor: pointer;
}
span.fa-comment {
  position: absolute;
  font-size: 0.6em;
  top: -4px;
  color: red;
  right: -4px;
}
span.num {
  position: absolute;
  font-size: 0.3em;
  top: 1px;
  color: #fff;
  right: 2px;
}

.img_for {
    border-radius: 50%;
}

.middler {
  text-align: center;
  margin: auto; /* Important */

}

.list-styled {
  background: #8b898e;
  color: #fff;
}


</style>

</head>



<body>



<script type="text/javascript">
   $(document).ready(function () {
       $("#sidebar").mCustomScrollbar({
           theme: "minimal"
       });

       $('#sidebarCollapse').on('click', function () {
           $('#sidebar, #content').toggleClass('active');
           $('.collapse.in').toggleClass('in');
           $('a[aria-expanded=true]').attr('aria-expanded', 'false');
       });
   });
</script>





<div class="wrapper">
      <!-- Sidebar Holder -->
      <nav id="sidebar">
                <div class="sidebar-header">

                        <a href="{% url 'index' %}">
                          <img src="{% static "images/logo/ez-manage-logo_1.png" %}"
                                                    alt="EasyCheck&#169;" class="dark-logo" />
                          <!--
                          <img src="{% static "images/logo/logo-light-icon.png" %}"
                                                    alt="EasyCheck&#169;" class="dark-logo" />
                          <img src="{% static "images/logo/logo-light-text.png" %}"
                                                    alt="EasyCheck&#169;" class="dark-logo" />
                          -->
                          </a>

                </div>

                <ul class="list-unstyled components">
                    <h4><p>Operasyon ve Denetim Sistemleri</p></h4>
                   {% if  user.profile.denetci == "E" or user.is_superuser %}
                    <li>
                        <a href="#pageSubmenu1" data-toggle="collapse" aria-expanded="false">Yerinde Denetim</a>
                        <ul class="collapse list-unstyled" id="pageSubmenu1">
                            <li class="list-styled" > <a href="/islem">Bekleyen Planlı Denetim</a></li>
                            <li><a href="/islem/rutin_baslat">Rutin Denetim Başlatma</a></li>
                            <li><a href="/islem/devam_liste">Devam Eden Denetimler</a></li>
                            <li><a href="/islem/acil_devam_sec"><b><font color="f44336">Acil Bildirim</font></b></a></li>
                            <li><a href="/islem/sonuc">Denetim Sonuç Detayları</a></li>
                            <li><a href="/islem/rapor_yazisi">Rapor Yazısı</a></li>
                        </ul>
                    </li>
                  {% endif %}

                  {% if  user.profile.denetim_grup_yetkilisi == "E" or user.is_superuser %}
                   <li>
                      <a href="#pageSubmenu2" data-toggle="collapse" aria-expanded="false">Denetim Oluştur</a>
                      <ul class="collapse list-unstyled" id="pageSubmenu2">
                        <li><a href="/islem/denetim/teksayfa_yarat">Denetim Yarat</a></li>
                        <li><a href="/islem/denetim/teksayfa_duzenle">Denetim Düzenle</a></li>
                        <li><a href="/islem/denetim/teksayfa_sil">Denetim Sil</a></li>
                        <li><a href="/islem/denetim">Denetim Detayları</a><!-- row.... --></li>
                      </ul>
                   </li>
                  {% endif %}

                  {% if  user.profile.denetim_grup_yetkilisi == "E" or user.is_superuser %}
                   <li>
                    <a href="#pageSubmenu3" data-toggle="collapse" aria-expanded="false">Denetimler</a>
                    <ul class="collapse list-unstyled" id="pageSubmenu3">
                      <li><a href="/islem/denetim/baslanmislar">Başlanmış Denetimler</a></li>
                      <li><a href="/islem/denetim/raporlar">Denetim Raporları</a></li>
                      <li><a href="/islem/denetim/iptal">Denetim İptal</a></li>
                    </ul>
                   </li>
                  {% endif %}

                  {% if  user.profile.denetim_grup_yetkilisi == "E" or user.is_superuser %}
                   <li>
                    <a href="#pageSubmenu4" data-toggle="collapse" aria-expanded="false">Denetim Tanımları</a>
                      <ul class="collapse list-unstyled" id="pageSubmenu4">
                        <li><a href="/islem/tipi">Denetim Tipi</a></li>
                        <!-- <li><a href="/islem/zon">Denetim Alanı</a></li> -->
                        <li><a href="/islem/zon_listesi">Denetim Alanı</a></li>
                        <!-- <li><a href="/islem/bolum">Denetim Bölümü</a></li> -->
                        <li><a href="/islem/bolum_listesi">Denetim Bölümü</a></li>
                        <!-- <li><a href="/islem/detay">Denetim Sorusu</a></li>  -->
                        <li><a href="/islem/soru_listesi">Soru Listesi</a></li>
                        <li><a href="/islem/spv_listesi">Supervisor Listesi</a></li>
                      </ul>
                   </li>
                  {% endif %}

                  {% if  user.profile.isletme_projeyon == "E" or user.profile.opr_proje_yon == "E" or user.profile.opr_alan_sefi == "E" or user.is_superuser %}
                   <li>
                    <a href="#pageSubmenu5" data-toggle="collapse" aria-expanded="false">Proje Takip</a>
                     <ul class="collapse list-unstyled" id="pageSubmenu5">
                        <li><a href="/islem/projealanlari">Proje Alanları</a></li>
                        <li><a href="/islem/yer">Yer</a></li>
                        <li><a href="/islem/rfid">RFID</a></li>
                        <li><a href="/islem/eleman">Çalışan</a></li>
                        <li><a href="/islem/eskibul">Eski Çalışan</a></li>
                        <li><a href="/islem/memnuniyet_list">WS-Memnuniyet Listele </a></li>
                        <li><a href="/islem/operasyon_list">WS-Operasyon Listele </a></li>
                        <li><a href="/islem/den_saha_list">WS-Denetim Listele </a></li>
                        <li><a href="/islem/ariza_list">WS-Ariza Listele </a></li>
                        <li><a href="/islem/sayi_list">WS-Sayı Listele </a></li>
                        <li><a href="/islem/yerud_list">WS-Yer Bilgisi Listele </a></li>
                    </ul>
                 </li>
                {% endif %}

                {% if  user.profile.isletme_projeyon == "E" or user.profile.opr_proje_yon == "E" or user.profile.opr_alan_sefi == "E" or user.is_superuser %}
                 <li>
                  <a href="#pageSubmenu6" data-toggle="collapse" aria-expanded="false">Proje Raporları</a>
                   <ul class="collapse list-unstyled" id="pageSubmenu6">
                      <li><a href="/islem/rapormemnuniyet">Proje Memnuniyet Raporu</a></li>
                      <li><a href="/islem/gunlukyer">Günlük Analiz Raporu</a></li>
                  </ul>
               </li>
              {% endif %}

                {% if  user.profile.opr_merkez_yon == "E" or  user.is_superuser %}
                 <li>
                  <a href="#pageSubmenu7" data-toggle="collapse" aria-expanded="false">Projeler Takip</a>
                   <ul class="collapse list-unstyled" id="pageSubmenu7">
                      <li><a href="/islem/mk_projealanlari">Proje Alanları</a></li>
                      <li><a href="/islem/mk_yer">Yer</a></li>
                      <li><a href="/islem/mk_rfid">RFID</a></li>
                      <li><a href="/islem/mk_memnuniyet_list">WS-Memnuniyet Listele </a></li>
                      <li><a href="/islem/mk_operasyon_list">WS-Operasyon Listele </a></li>
                      <li><a href="/islem/mk_den_saha_list">WS-Denetim Listele </a></li>
                      <li><a href="/islem/mk_ariza_list">WS-Ariza Listele </a></li>
                      <li><a href="/islem/mk_sayi_list">WS-Sayı Listele </a></li>
                  </ul>
               </li>
              {% endif %}

              {% if  user.profile.opr_merkez_yon == "E" or  user.is_superuser %}
               <li>
                <a href="#pageSubmenu8" data-toggle="collapse" aria-expanded="false">Projeler Raporları</a>
                 <ul class="collapse list-unstyled" id="pageSubmenu8">
                    <li><a href="/islem/rapor_mk_memnuniyet">Memnuniyet Raporları</a></li>
                    <li><a href="/islem/rapor_krs_memnuniyet">Memnuniyet Karşılaştırma</a></li>
                    <li><a href="/islem/sayi_create">WS-Sayı Ekle</a></li>
                  </ul>
                </li>
                {% endif %}

                {% if user.is_superuser %}
                 <li>
                    <a href="#pageSubmenu9" data-toggle="collapse" aria-expanded="false">Diğer İşlemler</a>
                    <ul class="collapse list-unstyled" id="pageSubmenu9">
                        <li><a href="/islem/grup">Grup</a></li>
                        <li><a href="/islem/sirket">Şirket</a></li>
                        <li><a href="/islem/proje">Proje</a></li>
                        <li><a href="/islem/opr_admin">Sistem Yöneticisi Ata</a></li>
                        <li><a href="/islem/dosyalari_duzenle">Dosyaları Düzenle</a></li>
                        <li><a href="/islem/ad_yerud_list">WS-Yer Bilgisi Listele </a></li>
                        <li><a href="/islem/memnuniyet_create">WS-Memnuniyet Ekle</a></li>
                        <li><a href="/islem/operasyon_create">WS-Operasyon Ekle</a></li>
                        <li><a href="/islem/den_saha_create">WS-Denetim Ekle</a></li>
                        <li><a href="/islem/ariza_create">WS-Ariza Ekle</a></li>
                        <li><a href="/islem/sayi_create">WS-Sayı Ekle</a></li>
                        <!-- <li><a href="/islem/rfid_list">Rfid Listele </a></li>
                        <li><a href="/islem/rfid_create">Rfid Ekle</a></li> -->
                        <li><a href="/islem/macnoyer">WS-Macno Yer</a></li>
                        <li><a href="/islem/macnoyer_degis">WS-Macno Yer Değiş</a></li>
                        <li><a href="/islem/yerud_create">WS-Yer Bilgisi Ekle</a></li>
                        <li><a href="/islem/rfid_filter">WS-Rfid Filtrele </a></li>
                        <li><a href="/islem/qrdosyasi">QRCode</a></li>
                        <li><a href="/islem/sms_mesaj">SMS Mesaj</a></li>
                        <li><a href="/islem/deneme_dropdown">deneme dropdown</a></li>
                        <!-- <li><a href="/islem/qrcode">QR code</a></li> -->
                        <li><a href="/notification/create">bildirim yarat</a></li>
                        <li><a href="/notification">bildirim listele</a></li>
                    </ul>
                 </li>
                {% endif %}

               </ul>


            </nav>


    <!-- Page Content Holder -->
    <div id="content">

            <nav class="navbar navbar-default">
                   <div class="container-fluid">
                      <div class="row">


                                <div class="navbar-header col-md-1">
                                    <button type="button" id="sidebarCollapse" class="btn btn-info navbar-btn">
                                        <i class="glyphicon glyphicon-align-left"></i>
                                        <span></span>
                                    </button>
                                </div>



                                {% if user.profile.profil_resmi %}
                                <div class="col-md-4 c"><font color="white"> <a class="middler" href="#" onclick="return false;"><img class="img_for" src="{{ user.profile.profil_resmi.url }}" height="42" width="42" /> {{ user.get_full_name }}</a></font></div>
                                {% else %}
                                <div class="col-md-4 c"><font color="white"> <a class="middler" href="#" onclick="return false;"><img class="img_for" src="{{ STATIC_URL }}images/user/genericUser.png" height="42" width="42" />{{ user.get_full_name }}</a></font></div>
                                {% endif %}


                                {% if user.profile.isletme_projeyon == "E" or user.profile.opr_proje_yon == "E" or user.profile.opr_alan_sefi == "E" %}
                                <div class="col-md-2 c" ><a class="dropbtn2 middler" onclick="myFunction()">Bildirim(<span id="mynum"></span>)<i class="fa fa-caret-down"></i> </a>
                                   <div class="dropdown-content2" id="myDropdown2">
                                   </div>
                                </div>
                                {%  else  %}
                                <div class="col-md-2 c" >
                                </div>
                                {% endif %}



                             {% if user.is_staff %}
                             <div class="col-md-2 c"><a class="middler" href="/admin/"><font color="white">Ayarlar</font></a></div>
                             {% else %}
                             <div class="col-md-2 c"> </div>
                             {% endif %}

                            <div class="col-md-3 c"><a class="middler" href="{% url 'logout'%}?next={{request.path}}"><font color="white"><span class="glyphicon glyphicon-log-out"></span> Çıkış</font></a></div>




                      </div>  <!-- row -->

                  </div>   <!-- container fluid -->
                </nav>

                {% block content %}    {% endblock %}

        </div>  <!-- content -->
  </div>





  <script>
  /* When the user clicks on the button,
  toggle between hiding and showing the dropdown content */
  function myFunction() {
      //alert("my function...");
      document.getElementById("myDropdown2").classList.toggle("show");
      }
      // Close the dropdown if the user clicks outside of it
      window.onclick = function(e) {
        if (!e.target.matches('.dropbtn2')) {
          var myDropdown = document.getElementById("myDropdown2");
            if (myDropdown.classList.contains('show')) {
              myDropdown.classList.remove('show');
            }
          }
        }
  </script>


  <script>
        $(document).ready(function(){
                      //alert("document ready..");
                      new_notif();
                      myInterval();
             });  /* document ready  kapanıyor */
  </script>



<!--  bildirimlerin her 1  dakikada bir okunması için zaman planı -->
<script>
  var myVar;
  function myInterval() {
      myVar = setInterval(new_notif, 120000);
  }
</script>
<!--    -->



<script>

  function new_notif()
  {
      //alert("buraya geldi ... new notif... on click...");
      var selected = "deneme";
      console.log(selected);
      $.ajax({
        url : "/bildirim/",
        type : "GET",
        dataType: "text",
        contentType: 'application/json; charset=utf-8',
        data : {
          'selected' : selected,
           },
        success: function(data) {
            //alert(data);
            var json = $.parseJSON(data);
            //alert(json.length);
            document.getElementById("mynum").innerHTML = json.length;
            $(myDropdown2).empty();
            for (var i=0;i<json.length;++i)
              {
                  /*  alert(" maryak......");  */
                  var getdiv = document.getElementById('myDropdown2');
                  var createA = document.createElement('a');
                  var createAText = document.createTextNode(json[i].message);
                  //alert(createAText);
                  createA.setAttribute('href', "/islem/notification/");
                  createA.appendChild(createAText);
                  getdiv.appendChild(createA);
              }
            },
        failure: function() {
            alert("bildirim listesi başarısız...");
            }
        });  /* ajax kapa...*/

  }


</script>



</body>
</html>
